{
  "info": {
    "_postman_id": "tpi-collection-2025",
    "name": "TPI - Pruebas de Endpoints con Roles",
    "description": "Colecci√≥n de pruebas para validar endpoints del API Gateway con roles (Cliente, Transportista, Operador)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "üîë Autenticaci√≥n",
      "item": [
        {
          "name": "Login - Cliente",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  var data = pm.response.json();",
                  "  pm.collectionVariables.set('token_cliente', data.access_token);",
                  "  pm.test('‚úÖ Token Cliente obtenido', function() {",
                  "    pm.expect(data).to.have.property('access_token');",
                  "  });",
                  "} else {",
                  "  pm.test('‚ùå Error en login Cliente', function() {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "  });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "client_id",
                  "value": "tpi-client",
                  "type": "text"
                },
                {
                  "key": "client_secret",
                  "value": "tpi-secret",
                  "type": "text"
                },
                {
                  "key": "grant_type",
                  "value": "password",
                  "type": "text"
                },
                {
                  "key": "username",
                  "value": "cliente1",
                  "type": "text"
                },
                {
                  "key": "password",
                  "value": "password123",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "http://localhost:8181/realms/tpi-realm/protocol/openid-connect/token",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8181",
              "path": [
                "realms",
                "tpi-realm",
                "protocol",
                "openid-connect",
                "token"
              ]
            }
          }
        },
        {
          "name": "Login - Transportista",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  var data = pm.response.json();",
                  "  pm.collectionVariables.set('token_transportista', data.access_token);",
                  "  pm.test('‚úÖ Token Transportista obtenido', function() {",
                  "    pm.expect(data).to.have.property('access_token');",
                  "  });",
                  "} else {",
                  "  pm.test('‚ùå Error en login Transportista', function() {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "  });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "client_id",
                  "value": "tpi-client",
                  "type": "text"
                },
                {
                  "key": "client_secret",
                  "value": "tpi-secret",
                  "type": "text"
                },
                {
                  "key": "grant_type",
                  "value": "password",
                  "type": "text"
                },
                {
                  "key": "username",
                  "value": "transportista1",
                  "type": "text"
                },
                {
                  "key": "password",
                  "value": "password123",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "http://localhost:8181/realms/tpi-realm/protocol/openid-connect/token",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8181",
              "path": [
                "realms",
                "tpi-realm",
                "protocol",
                "openid-connect",
                "token"
              ]
            }
          }
        },
        {
          "name": "Login - Operador",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  var data = pm.response.json();",
                  "  pm.collectionVariables.set('token_operador', data.access_token);",
                  "  pm.test('‚úÖ Token Operador obtenido', function() {",
                  "    pm.expect(data).to.have.property('access_token');",
                  "  });",
                  "} else {",
                  "  pm.test('‚ùå Error en login Operador', function() {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "  });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "client_id",
                  "value": "tpi-client",
                  "type": "text"
                },
                {
                  "key": "client_secret",
                  "value": "tpi-secret",
                  "type": "text"
                },
                {
                  "key": "grant_type",
                  "value": "password",
                  "type": "text"
                },
                {
                  "key": "username",
                  "value": "operador1",
                  "type": "text"
                },
                {
                  "key": "password",
                  "value": "password123",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "http://localhost:8181/realms/tpi-realm/protocol/openid-connect/token",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8181",
              "path": [
                "realms",
                "tpi-realm",
                "protocol",
                "openid-connect",
                "token"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üì¶ Servicio Contenedores",
      "item": [
        {
          "name": "‚úÖ GET /api/clientes (Sin Auth)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8080/api/clientes",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "clientes"
              ]
            }
          }
        },
        {
          "name": "‚úÖ GET /api/contenedores (Sin Auth)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8080/api/contenedores",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "contenedores"
              ]
            }
          }
        },
        {
          "name": "üîê POST /api/solicitudes (Solo CLIENTE)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('‚úÖ CLIENTE puede crear solicitud', function() {",
                  "  pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "",
                  "pm.test('‚ùå TRANSPORTISTA NO puede crear solicitud', function() {",
                  "  pm.collectionVariables.get('token_transportista');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token_cliente}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": 1,\n  \"descripcion\": \"Solicitud de transporte de contenedores\"\n}"
            },
            "url": {
              "raw": "http://localhost:8080/api/solicitudes",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "solicitudes"
              ]
            }
          }
        },
        {
          "name": "‚úÖ GET /api/solicitudes (Sin Auth)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8080/api/solicitudes",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "solicitudes"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üöö Servicio Transporte",
      "item": [
        {
          "name": "‚úÖ GET /api/camiones (Sin Auth)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8080/api/camiones",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "camiones"
              ]
            }
          }
        },
        {
          "name": "‚úÖ GET /api/rutas (Sin Auth)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8080/api/rutas",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "rutas"
              ]
            }
          }
        },
        {
          "name": "üîê GET /api/transportistas (Solo OPERADOR)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token_operador}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "http://localhost:8080/api/transportistas",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "transportistas"
              ]
            }
          }
        },
        {
          "name": "‚ùå GET /api/transportistas (CLIENTE - Debe fallar)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token_cliente}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "http://localhost:8080/api/transportistas",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "transportistas"
              ]
            }
          }
        },
        {
          "name": "üîê GET /api/tramos (TRANSPORTISTA - Lectura)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token_transportista}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "http://localhost:8080/api/tramos",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "tramos"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üí∞ Servicio Tarifa",
      "item": [
        {
          "name": "üîê GET /api/tarifas (Solo OPERADOR)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token_operador}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "http://localhost:8080/api/tarifas",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "tarifas"
              ]
            }
          }
        },
        {
          "name": "‚ùå GET /api/tarifas (CLIENTE - Debe fallar)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token_cliente}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "http://localhost:8080/api/tarifas",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "tarifas"
              ]
            }
          }
        },
        {
          "name": "üîê POST /api/tarifas (Solo OPERADOR)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token_operador}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"valorKm\": 50.0,\n  \"valorLitroCombustible\": 280.0\n}"
            },
            "url": {
              "raw": "http://localhost:8080/api/tarifas",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "tarifas"
              ]
            }
          }
        },
        {
          "name": "‚úÖ GET /api/tarifas/valor-combustible (Autenticado)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token_operador}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "http://localhost:8080/api/tarifas/valor-combustible",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "tarifas",
                "valor-combustible"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üè¢ Servicio Dep√≥sito",
      "item": [
        {
          "name": "‚úÖ GET /api/provincias (Sin Auth)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8080/api/provincias",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "provincias"
              ]
            }
          }
        },
        {
          "name": "‚úÖ GET /api/ciudades (Sin Auth)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8080/api/ciudades",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "ciudades"
              ]
            }
          }
        },
        {
          "name": "‚úÖ GET /api/depositos (Sin Auth)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8080/api/depositos",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "depositos"
              ]
            }
          }
        },
        {
          "name": "‚úÖ GET /api/ubicaciones (Sin Auth)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8080/api/ubicaciones",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8080",
              "path": [
                "api",
                "ubicaciones"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üîç Servicio Discovery (Eureka)",
      "item": [
        {
          "name": "‚úÖ Eureka Dashboard",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:18761/",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "18761",
              "path": [
                ""
              ]
            }
          }
        },
        {
          "name": "‚úÖ Servicios Registrados",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:18761/eureka/apps",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "18761",
              "path": [
                "eureka",
                "apps"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üîê Keycloak",
      "item": [
        {
          "name": "‚úÖ Keycloak Admin Console",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:8181/admin",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "8181",
              "path": [
                "admin"
              ]
            }
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "token_cliente",
      "value": "",
      "type": "string"
    },
    {
      "key": "token_transportista",
      "value": "",
      "type": "string"
    },
    {
      "key": "token_operador",
      "value": "",
      "type": "string"
    }
  ]
}
